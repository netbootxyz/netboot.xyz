#!ipxe

# IPFire
# https://www.ipfire.org/

goto ${menu} ||

:ipfire
clear osversion
set os {{ releases.ipfire.name }}
menu ${os} - Image Sig Checks: [${img_sigs_enabled}]
{% for item in releases.ipfire.versions %}
item {{ item.code_name }} ${space} ${os} {{ item.name }}
{% endfor %}
isset ${osversion} || choose osversion || goto linux_menu
echo ${cls}
set ipfire_mirror {{ releases.ipfire.mirror }}
set dir releases/ipfire-2.x/${osversion}/images/x86_64
goto ipfire_images

:ipfire_images
imgfree
kernel ${ipfire_mirror}/${dir}/vmlinuz ${console} vga=791 initrd=instroot
initrd ${ipfire_mirror}/${dir}/instroot
echo
echo MD5sums:
md5sum vmlinuz instroot
iseq ${img_sigs_enabled} true && goto verify_sigs || goto skip_sigs
:verify_sigs
echo
echo Checking signatures...
imgverify vmlinuz ${sigs}ipfire/${dir}/vmlinuz.sig || goto error
imgverify instroot ${sigs}ipfire/${dir}/instroot.sig || goto error
echo Signatures verified!
echo
:skip_sigs
boot

:ipfire_exit
clear menu
exit 0
